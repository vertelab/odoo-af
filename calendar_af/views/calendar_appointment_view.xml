<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record id="view_calendar_appointment_calendar" model="ir.ui.view">
        <field name="name">calendar.appointment.calendar</field>
        <field name="model">calendar.appointment</field>
        <field name="priority" eval="2"/>
        <field name="arch" type="xml">
            <calendar string="Appointments" date_start="start" date_stop="stop" date_delay="duration"
                      color="type_id">
                <field name="name"/>
            </calendar>
        </field>
    </record>

    <record id="view_calendar_appointment_tree" model="ir.ui.view">
        <field name="name">calendar.appointment.tree</field>
        <field name="model">calendar.appointment</field>
        <field name="priority" eval="2"/>
        <field name="arch" type="xml">
            <tree string="Appointments">
                <field name="type_id"/>
                <field name="start"/>
                <field name="duration_selection"/>
                <field name="stop" />
                <field name="case_worker_name" />
                <field name="partner_id" />
                <field name="operation_id" />
            </tree>
        </field>
    </record>

    <record id="view_calendar_appointment_kanban" model="ir.ui.view">
        <field name="name">calendar.appointment.kanban</field>
        <field name="model">calendar.appointment</field>
        <field name="priority" eval="2"/>
        <field name="arch" type="xml">
            <kanban>
                <field name="name" />
                <field name="start" />
                <field name="stop" />
                <field name="operation_id" />
                <templates>
                    <t t-name="kanban-box">
                        <div class="oe_kanban_global_click">
                            <div class="oe_kanban_details">
                                <strong class="o_kanban_record_title">
                                    <field name="name"/>
                                </strong>
                                <div class="o_kanban_tags_section">
                                    <ul>
                                        <li>
                                            Start:
                                            <field name="start"/>
                                        </li>
                                        <li>
                                            Stop:
                                            <field name="stop"/>
                                        </li>
                                        <li>
                                            Operation:
                                            <field name="operation_id" />
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>

    <record id="view_calendar_appointment_local_calendar" model="ir.ui.view">
        <field name="name">calendar.appointment.local.calendar</field>
        <field name="model">calendar.appointment</field>
        <field name="priority" eval="2"/>
        <field name="arch" type="xml">
            <calendar string="Appointments" date_start="start" date_stop="stop" date_delay="duration"
                color="operation_id">
                <field name="name" />
            </calendar>
        </field>
    </record>

    <record id="view_calendar_appointment_local_tree" model="ir.ui.view">
        <field name="name">calendar.appointment.local.tree</field>
        <field name="model">calendar.appointment</field>
        <field name="priority" eval="2"/>
        <field name="arch" type="xml">
            <tree string="Appointments">
                <field name="type_id" />
                <field name="weekday"/>
                <field name="start" />
                <field name="duration_text"/>
                <field name="case_worker_name" />
                <field name="partner_id" />
                <field name="operation_id" />
            </tree>
        </field>
    </record>

    <record id="view_calendar_appointment_form" model="ir.ui.view">
        <field name="name">calendar.appointment.form</field>
        <field name="model">calendar.appointment</field>
        <field name="priority" eval="2"/>
        <field name="arch" type="xml">
            <form>
                    <h1>
                        <span class="oe_edit_only">Book meeting with </span>
                        <span class="oe_read_only">Meeting with </span>
                        &amp;#32;
                        <field string="Attendees" name="partner_id" placeholder="Select attendee..." readonly="1"/>
                    </h1>
                    <group>
                        <group>
                            <field name="name" invisible="1"/>
                            <field string="Meeting channel" name="channel" readonly="0"
                                   domain="[('name', '!=', 'None')]"
                                   options="{'limit':15,'no_quick_create':True,'no_create_edit':True,'no_create':True,
                                            'no_edit':True,'no_open':True}"/>
                            <field string="Meeting channel" name="channel_name" invisible="1"
                                   options="{'limit':15,'no_quick_create':True,'no_create_edit':True,'no_create':True,
                                            'no_edit':True,'no_open':True}"/>
                            <field string="Meeting type" name="type_id"
                                   domain="[('channel', '=', channel)]"
                                   options="{'limit':15,'no_quick_create':True,'no_create_edit':True,'no_create':True,'no_edit':True,
                               'no_open':True}"
                                   context="{ 'default_channel': %(calendar_channel.channel_pdm)d }"/>
                            <field string="Meeting subject" name="name" placeholder="e.g. Business Lunch"
                                   invisible="1"/>
                            <field name="duration_selection" invisible="1"/>
                        </group>
                        <group>
                            <field string="Case worker" name="user_id"
                                   placeholder="Select case worker..."
                                   attrs="{'invisible':[('channel', '!=', %(calendar_channel.channel_local)d)]}"
                                   options="{'no_open': True}" invisible="1"
                                   context="{'formatted_display_name': True}"/>
                        </group>
                    </group>
                    <notebook>
                        <page name="page_details" string="Meeting Details">
                            <group>
                                <group>
                                    <label for="start" string="start" class="oe_read_only"/>
                                    <label for="stop" string="stop" class="oe_read_only"/>
                                    <field name="start" class="oe_read_only" nolabel="1" options="{'datepicker': {'hide': {'seconds': True}}}"/>
                                    <field name="stop" class="oe_read_only" nolabel="1"/>
                                    <field name="duration" invisible="1"/>
                                    <field name="operation_id"  options="{'limit':15,'no_quick_create':True,'no_create_edit':True,
                                           'no_create':True,'no_edit':True,'no_open':True}"
                                           attrs="{'required':[('channel', '!=', %(calendar_channel.channel_pdm)d)],
                                      'invisible':[('channel', '!=', %(calendar_channel.channel_local)d)]}" />
                                </group>
                                <group>
                                    <field string="Description" name="description" invisible="1"/>
                                    <field name="occasion_ids" invisible="1" widget="many2many_tags"/>
                                    <field name="show_suggestion_ids" invisible="1"/>
                                </group>
                            </group>
                        </page>
                    </notebook>
                    <span aria-atomic="true" class="btn-group oe-right oe_button_box">
                        <button class="oe_edit_only" name="compute_suggestion_ids" type="object" string="Get free occasions"/>
                    </span>
                    <field name="suggestion_ids" class="oe_edit_only"
                           attrs="{'invisible':[('show_suggestion_ids','=',False)]}">
                        <tree string="Bookable Occasions" limit="10" create="false">
                            <field name="weekday"/>
                            <field name="start" options="{'datepicker': {'hide': {'seconds': True}}}"/>
                            <field name="duration_text"/>
                            <field name="type_id"/>
                            <field name="occasion_ids" invisible="1"/>
                            <button name="select_suggestion" type="object" string="Book"/>
                        </tree>
                        <form>
                        </form>
                    </field>
            </form>
        </field>
    </record>

    <record id="calendar_appointment_search" model="ir.ui.view">
        <field name="name">calendar.appointment.search</field>
        <field name="model">calendar.appointment</field>
        <field name="arch" type="xml">
            <search string="Rules">
                <field name="name"/>
                <field name="state"/>
                <field name="type_id"/>
                <field name="user_id"/>
                <filter
                        name="state_confirmed"
                        domain="[('state','=','confirmed')]"
                        string="Confirmed"
                />
                <group expand="0" string="Group By...">
                    <filter
                            name="group_by_state"
                            string="State"
                            domain="[]"
                            context="{'group_by':'state'}"
                    />
                    <filter
                            name="group_by_operation_id"
                            string="Operation"
                            domain="[]"
                            context="{'group_by':'operation_id'}"
                    />
                    <filter
                            name="group_by_type_id"
                            string="Meeting type"
                            domain="[]"
                            context="{'group_by':'type_id'}"
                    />
                    <filter
                            name="group_by_user_id"
                            string="Case worker"
                            domain="[]"
                            context="{'group_by':'user_id'}"
                    />
                </group>
            </search>
        </field>
    </record>

    <record id="calendar_appointment_local_search" model="ir.ui.view">
        <field name="name">calendar.appointment.local.search</field>
        <field name="model">calendar.appointment</field>
        <field name="arch" type="xml">
            <search string="Rules">
                <field name="name"/>
                <field name="state"/>
                <field name="type_id"/>
                <field name="user_id"/>
                <filter
                        name="additional_booking"
                        domain="[('additional_booking','=','True')]"
                        string="Additional bookings"
                />
                <filter
                        name="state_confirmed"
                        domain="[('state','=','confirmed')]"
                        string="Confirmed"
                />
                <group expand="0" string="Group By...">
                    <filter
                            name="group_by_state"
                            string="State"
                            domain="[]"
                            context="{'group_by':'state'}"
                    />
                    <filter
                            name="group_by_operation_id"
                            string="Operation"
                            domain="[]"
                            context="{'group_by':'operation_id'}"
                    />
                    <filter
                            name="group_by_type_id"
                            string="Meeting type"
                            domain="[]"
                            context="{'group_by':'type_id'}"
                    />
                    <filter
                            name="group_by_user_id"
                            string="Case worker"
                            domain="[]"
                            context="{'group_by':'user_id'}"
                    />
                    <filter
                            name="group_by_duration_text"
                            string="Duration"
                            domain="[]"
                            context="{'group_by':'duration_text'}"
                    />
                </group>
            </search>
        </field>
    </record>

    <record id="action_appointment" model="ir.actions.act_window">
        <field name="name">Appointments</field>
        <field name="res_model">calendar.appointment</field>
        <field name="view_mode">tree,calendar,kanban</field>
        <field name="view_id" ref="view_calendar_appointment_calendar"/>
        <field name="domain" eval="[('channel', '=', ref('calendar_channel.channel_pdm'))]"/>
        <field name="context">{'default_channel': 'PDM'}</field>
        <field name="search_view_id" ref="calendar_appointment_search"/>
    </record>

    <record id="action_local_appointment" model="ir.actions.act_window">
        <field name="name">Local appointments</field>
        <field name="res_model">calendar.appointment</field>
        <field name="view_mode">tree,calendar,form,kanban</field>
        <field name="view_id" ref="view_calendar_appointment_local_calendar"/>
        <field name="domain" eval="[('channel', '=', ref('calendar_channel.channel_local'))]"/>
        <!-- This should be a reference to the external id instead. -->
        <!-- <field name="context">{'default_channel': %(calendar_channel.channel_local)d}</field> -->
        <field name="context">{'default_channel': 'Local'}</field>
        <field name="search_view_id" ref="calendar_appointment_local_search"/>
    </record>

    <record id="action_view_calendar_appointment_calendar" model="ir.actions.act_window.view">
        <field name="act_window_id" ref="action_appointment"/>
        <field name="sequence" eval="2"/>
        <field name="view_mode">calendar</field>
        <field name="view_id" ref="view_calendar_appointment_calendar"/>
    </record>

    <record id="action_view_calendar_appointment_tree" model="ir.actions.act_window.view">
        <field name="act_window_id" ref="action_appointment"/>
        <field name="sequence" eval="1"/>
        <field name="view_mode">tree</field>
        <field name="view_id" ref="view_calendar_appointment_tree"/>
    </record>

    <record id="action_view_calendar_appointment_kanban" model="ir.actions.act_window.view">
        <field name="act_window_id" ref="action_appointment"/>
        <field name="sequence" eval="3"/>
        <field name="view_mode">kanban</field>
        <field name="view_id" ref="view_calendar_appointment_kanban"/>
    </record>

    <record id="action_view_calendar_appointment_local_calendar" model="ir.actions.act_window.view">
        <field name="act_window_id" ref="action_local_appointment"/>
        <field name="sequence" eval="2"/>
        <field name="view_mode">calendar</field>
        <field name="view_id" ref="view_calendar_appointment_local_calendar"/>
    </record>

    <record id="action_view_calendar_appointment_local_tree" model="ir.actions.act_window.view">
        <field name="act_window_id" ref="action_local_appointment"/>
        <field name="sequence" eval="1"/>
        <field name="view_mode">tree</field>
        <field name="view_id" ref="view_calendar_appointment_local_tree"/>
    </record>

    <record id="action_view_calendar_appointment_form" model="ir.actions.act_window.view">
        <field name="act_window_id" ref="action_local_appointment"/>
        <field name="sequence" eval="5"/>
        <field name="view_mode">form</field>
        <field name="view_id" ref="view_calendar_appointment_form"/>
    </record>

    <menuitem action="action_appointment" id="menu_action_appointment" parent="menu_pdm" sequence="12"/>
    <menuitem action="action_local_appointment" id="menu_action_local_appointment" parent="menu_local" sequence="13"
              groups="af_security.af_meeting_planner"/>
</odoo>
