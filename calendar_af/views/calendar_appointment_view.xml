<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record id="view_calendar_appointment_calendar" model="ir.ui.view">
        <field name="name">calendar.appointment.calendar</field>
        <field name="model">calendar.appointment</field>
        <field name="priority" eval="2" />
        <field name="arch" type="xml">
            <calendar string="Appointments" date_start="start" date_stop="stop" date_delay="duration"
                color="type_id">
                <field name="name" />
            </calendar>
        </field>
    </record>

    <record id="view_calendar_appointment_tree" model="ir.ui.view">
        <field name="name">calendar.appointment.tree</field>
        <field name="model">calendar.appointment</field>
        <field name="priority" eval="2" />
        <field name="arch" type="xml">
            <tree string="Appointments">
                <field name="type_id" />
                <field name="start" />
                <field name="duration"/>
                <field name="stop" />
                <field name="user_id" />
                <field name="partner_id" />
                <field name="location" />
                <field name="office_id" />
            </tree>
        </field>
    </record>

    <record id="view_calendar_appointment_kanban" model="ir.ui.view">
        <field name="name">calendar.appointment.kanban</field>
        <field name="model">calendar.appointment</field>
        <field name="priority" eval="2" />
        <field name="arch" type="xml">
            <kanban>
                <field name="name" />
                <field name="start" />
                <field name="stop" />
                <field name="office_id" />
                <templates>
                    <t t-name="kanban-box">
                        <div class="oe_kanban_global_click">
                            <div class="oe_kanban_details">
                                <strong class="o_kanban_record_title">
                                    <field name="name" />
                                </strong>
                                <div class="o_kanban_tags_section">
                                    <ul>
                                        <li>
                                            Start:
                                            <field name="start" />
                                        </li>
                                        <li>
                                            Stop:
                                            <field name="stop" />
                                        </li>
                                        <li>
                                            Office:
                                            <field name="office_id" />
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>

    <record id="view_calendar_appointment_local_calendar" model="ir.ui.view">
        <field name="name">calendar.appointment.local.calendar</field>
        <field name="model">calendar.appointment</field>
        <field name="priority" eval="2" />
        <field name="arch" type="xml">
            <calendar string="Appointments" date_start="start" date_stop="stop" date_delay="duration"
                color="office_id">
                <field name="name" />
            </calendar>
        </field>
    </record>

    <record id="view_calendar_appointment_local_tree" model="ir.ui.view">
        <field name="name">calendar.appointment.local.tree</field>
        <field name="model">calendar.appointment</field>
        <field name="priority" eval="2" />
        <field name="arch" type="xml">
            <tree string="Appointments">
                <field name="type_id" />
                <field name="start" />
                <field name="stop" />
                <field name="user_id" />
                <field name="partner_id" />
                <field name="location" />
                <field name="office_id" />
            </tree>
        </field>
    </record>

    <record id="view_calendar_appointment_form" model="ir.ui.view">
        <field name="name">calendar.appointment.form</field>
        <field name="model">calendar.appointment</field>
        <field name="priority" eval="2" />
        <field name="arch" type="xml">
            <form>
                <header>
                    <field name="state" nolabel="1" widget="statusbar" statusbar_visible="free,reserved,confirmed,done,canceled"/>
                </header>
                <sheet>
                    <group string="Book meeting">
                        <group>
                            <field name="name" invisible="1"/>
                            <field string="Meeting channel" name="channel" readonly="0"
                                domain="[('name', '!=', 'None')]"/>
                            <field string="Meeting channel" name="channel_name" invisible="1" />
                            <field string="Meeting type" name="type_id"
                                   domain="[('channel', '=', channel)]"
                               options="{'no_quick_create':True,'no_create_edit':True,'no_create':True,'no_edit':True}"
                               context="{ 'default_channel': %(calendar_channel.channel_pdm)d }"/>
                            <field string="Meeting subject" name="name" placeholder="e.g. Business Lunch" invisible="1" />
                        </group>
                        <group>
                            <field string="Attendees" name="partner_id" widget="many2oneattendee" placeholder="Select attendees..."  invisible="1"/>
                            <field string="Case worker" name="user_id" widget="many2oneattendee" placeholder="Select case worker..." 
                                attrs="{'invisible':[('channel', '!=', %(calendar_channel.channel_local)d)]}" />
                        </group>
                    </group>
                    <notebook>
                        <page name="page_details" string="Meeting Details">
                            <group>
                                <group>
                                    <field name="start" invisible="1"/>
                                    <field name="stop" invisible="1" />
                                    <field name="duration_selection" widget="radio"/>
                                    <field name="duration" invisible="1" />
                                </group> 
                                <group>
                                    <field name="office_id"  attrs="{'required':[('channel_name','!=','PDM')], 'invisible':[('channel', '!=', %(calendar_channel.channel_local)d)]}" />
                                    <field string="Description" name="description" invisible="1"/>
                                    <field name="occasion_ids" invisible="1" widget="many2many_tags" />
                                    <field name="show_suggestion_ids" invisible="1" />
                                </group>
                            </group>
                        </page>
                    </notebook>
                    <span aria-atomic="true" class="btn-group oe-right oe_button_box">
                        <button name="compute_suggestion_ids" type="object" string="Next" />
                    </span>
                    <field name="suggestion_ids" readonly="1"
                           attrs="{'invisible':[('show_suggestion_ids','=',False)]}">
                        <tree string="Bookable Occasions" limit="10" >
                            <field name="weekday" />
                            <field name="start" />
                            <field name="stop" />
                            <field name="duration" />
                            <field name="type_id" />
                            <field name="occasion_ids" invisible="1" />
                            <button name="select_suggestion" type="object" string="Book" />
                        </tree>
                    </field>
                </sheet>
            </form>
        </field>
    </record>

    <record id="view_calendar_appointment_move_form" model="ir.ui.view">
        <field name="name">calendar.appointment.move.form</field>
        <field name="model">calendar.appointment</field>
        <field name="priority" eval="2" />
        <field name="arch" type="xml">
            <form>
                <header>
                    <field name="state" nolabel="1" widget="statusbar" statusbar_visible="free,reserved,confirmed,done,canceled"/>
                </header>
                <sheet>
                    <group string="Move meeting">
                        <group>
                            <field name="name" invisible="1"/>
                            <field string="Meeting channel" name="channel" readonly="0" />
                            <field string="Meeting channel" name="channel_name" invisible="1" />
                            <field string="Meeting type" name="type_id" domain="[('channel', '=', channel)]" context="{ 'default_channel': %(calendar_channel.channel_pdm)d }"/>
                            <field string="Meeting subject" name="name" placeholder="e.g. Business Lunch" invisible="1" />
                        </group>
                        <group>
                            <field string="Attendees" name="partner_id" widget="many2oneattendee" placeholder="Select attendees..." attrs="{'readonly':[('state', '!=', 'free')]}"/>
                            <field string="Case worker" name="user_id" widget="many2oneattendee" placeholder="Select case worker..." 
                                attrs="{'invisible':[('channel', '!=', %(calendar_channel.channel_local)d)]}" />
                            <field string="Move reason" name="cancel_reason" required="1"/>
                        </group>
                    </group>
                    <notebook>
                        <page name="page_details" string="Meeting Details">
                            <group>
                                <group>
                                    <field name="start" invisible="1"/>
                                    <field name="stop" invisible="1" />
                                    <field name="duration_selection" widget="radio"/>
                                    <field name="duration" invisible="1" />
                                </group>
                                <group>
                                    <field name="office_id"  attrs="{'invisible':[('channel', '!=', %(calendar_channel.channel_local)d)]}" />
                                    <field string="Description" name="description" invisible="1"/>
                                    <field name="occasion_ids" invisible="1" widget="many2many_tags" />
                                </group>
                            </group>
                        </page>
                    </notebook>
                    <span aria-atomic="true" class="btn-group oe-right oe_button_box">
                        <button name="compute_suggestion_ids" type="object" string="Update" />
                    </span>
                    <field name="suggestion_ids">
                        <tree string="Bookable Occasions" limit="10">
                            <field name="weekday" />
                            <field name="start" />
                            <field name="stop" />
                            <field name="duration" />
                            <field name="type_id" />
                            <field name="occasion_ids" invisible="1" />
                            <button name="select_suggestion_move" type="object" string="Move" />
                        </tree>
                    </field>
                </sheet>
            </form>
        </field>
    </record>

    <record id="calendar_appointment_search" model="ir.ui.view">
        <field name="name">calendar.appointment.search</field>
        <field name="model">calendar.appointment</field>
        <field name="arch" type="xml">
            <search string="Rules">
                <field name="name" />
                <field name="state" />
                <field name="type_id" />
                <field name="user_id"/>
                <filter
                    name="state_confirmed"
                    domain="[('state','=','confirmed')]"
                    string="Confirmed"
                />
                <group expand="0" string="Group By...">
                    <filter
                        name="group_by_state"
                        string="State"
                        domain="[]"
                        context="{'group_by':'state'}"
                    />
                    <filter
                        name="group_by_office_id"
                        string="office_id"
                        domain="[]"
                        context="{'group_by':'office_id'}"
                    />
                    <filter
                        name="group_by_type_id"
                        string="Meeting type"
                        domain="[]"
                        context="{'group_by':'type_id'}"
                    />
                    <filter
                        name="group_by_user_id"
                        string="Case worker"
                        domain="[]"
                        context="{'group_by':'user_id'}"
                    />
                </group>
            </search>
        </field>
    </record>

    <record id="calendar_appointment_local_search" model="ir.ui.view">
        <field name="name">calendar.appointment.local.search</field>
        <field name="model">calendar.appointment</field>
        <field name="arch" type="xml">
            <search string="Rules">
                <field name="name" />
                <field name="state" />
                <field name="type_id" />
                <field name="user_id"/>
                <filter
                    name="state_confirmed"
                    domain="[('state','=','confirmed')]"
                    string="Confirmed"
                />
                <group expand="0" string="Group By...">
                    <filter
                        name="group_by_state"
                        string="State"
                        domain="[]"
                        context="{'group_by':'state'}"
                    />
                    <filter
                        name="group_by_office_id"
                        string="office_id"
                        domain="[]"
                        context="{'group_by':'office_id'}"
                    />
                    <filter
                        name="group_by_type_id"
                        string="Meeting type"
                        domain="[]"
                        context="{'group_by':'type_id'}"
                    />
                    <filter
                        name="group_by_user_id"
                        string="Case worker"
                        domain="[]"
                        context="{'group_by':'user_id'}"
                    />
                </group>
            </search>
        </field>
    </record>

    <record id="action_appointment" model="ir.actions.act_window">
        <field name="name">Appointments</field>
        <field name="res_model">calendar.appointment</field>
        <field name="view_mode">tree,calendar,form,kanban</field>
        <field name="view_id" ref="view_calendar_appointment_calendar" />
        <field name="domain">[('channel', '=', 'PDM')]</field>
        <field name="context">{'default_channel': 'PDM'}</field>
        <field name="search_view_id" ref="calendar_appointment_search" />
    </record>

    <record id="action_local_appointment" model="ir.actions.act_window">
        <field name="name">Local appointments</field>
        <field name="res_model">calendar.appointment</field>
        <field name="view_mode">tree,calendar,form,kanban</field>
        <field name="view_id" ref="view_calendar_appointment_local_calendar" />
        <!-- This should be a reference to the external id instead. -->
        <field name="domain">[('channel', '=', 'Local')]</field>
        <!-- <field name="context">{'default_channel': %(calendar_channel.channel_local)d}</field> -->
        <field name="context">{'default_channel': 'Local'}</field>
        <field name="search_view_id" ref="calendar_appointment_local_search" />
    </record>

    <record id="action_view_calendar_appointment_calendar" model="ir.actions.act_window.view">
        <field name="act_window_id" ref="action_appointment" />
        <field name="sequence" eval="2" />
        <field name="view_mode">calendar</field>
        <field name="view_id" ref="view_calendar_appointment_calendar" />
    </record>

    <record id="action_view_calendar_appointment_tree" model="ir.actions.act_window.view">
        <field name="act_window_id" ref="action_appointment" />
        <field name="sequence" eval="1" />
        <field name="view_mode">tree</field>
        <field name="view_id" ref="view_calendar_appointment_tree" />
    </record>

    <record id="action_view_calendar_appointment_kanban" model="ir.actions.act_window.view">
        <field name="act_window_id" ref="action_appointment" />
        <field name="sequence" eval="3" />
        <field name="view_mode">kanban</field>
        <field name="view_id" ref="view_calendar_appointment_kanban" />
    </record>

    <record id="action_view_calendar_appointment_local_calendar" model="ir.actions.act_window.view">
        <field name="act_window_id" ref="action_local_appointment" />
        <field name="sequence" eval="2" />
        <field name="view_mode">calendar</field>
        <field name="view_id" ref="view_calendar_appointment_local_calendar" />
    </record>

    <record id="action_view_calendar_appointment_local_tree" model="ir.actions.act_window.view">
        <field name="act_window_id" ref="action_local_appointment" />
        <field name="sequence" eval="1" />
        <field name="view_mode">tree</field>
        <field name="view_id" ref="view_calendar_appointment_local_tree" />
    </record>

    <record id="action_view_calendar_appointment_form" model="ir.actions.act_window.view">
        <field name="act_window_id" ref="action_local_appointment" />
        <field name="sequence" eval="5" />
        <field name="view_mode">form</field>
        <field name="view_id" ref="view_calendar_appointment_form" />
    </record>

    <menuitem action="action_appointment" id="menu_action_appointment" parent="menu_pdm" sequence="12" />
    <menuitem action="action_local_appointment" id="menu_action_local_appointment" parent="menu_local" sequence="13" groups="af_security.af_employers_editor,af_security.af_jobseekers_editor"/>
</odoo>
